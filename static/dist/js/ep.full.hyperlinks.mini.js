exports.moduleList=(()=>{const e=require("ep_etherpad-lite/static/js/pad_utils").randomString,t=(require("ep_etherpad-lite/static/js/underscore"),function(){"use strict";const e=function(e){return e.match(/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/)};function t(t){if(!t)return;if(/[^a-z0-9\:\/\?\#\[\]\@\!\$\&\'\(\)\*\+\,\;\=\.\-\_\~\%]/i.test(t))return;if(/%[^0-9a-f]/i.test(t))return;if(/%[0-9a-f](:?[^0-9a-f]|$)/i.test(t))return;let n=[],i="",r="",l="",a="",o="",s="";if(n=e(t),i=n[1],r=n[2],l=n[3],a=n[4],o=n[5],i&&i.length&&l.length>=0){if(r&&r.length){if(0!==l.length&&!/^\//.test(l))return}else if(/^\/\//.test(l))return;if(/^[a-z][a-z0-9\+\-\.]*$/.test(i.toLowerCase()))return s+=i+":",r&&r.length&&(s+="//"+r),s+=l,a&&a.length&&(s+="?"+a),o&&o.length&&(s+="#"+o),s}}function n(n,i){if(!t(n))return;let r=[],l="",a="",o="",s="",c="",p="",d="";if(r=e(n),l=r[1],a=r[2],o=r[3],c=r[4],p=r[5],l){if(i){if("https"!=l.toLowerCase())return}else if("http"!=l.toLowerCase())return;if(a)return/:(\d+)$/.test(a)&&(s=a.match(/:(\d+)$/)[0],a=a.replace(/:\d+$/,"")),d+=l+":",d+="//"+a,s&&(d+=s),d+=o,c&&c.length&&(d+="?"+c),p&&p.length&&(d+="#"+p),d}}function i(e){return n(e,!0)}function r(e){return n(e)||i(e)}return{is_uri:t,is_http_uri:n,is_https_uri:i,is_web_uri:r,isUri:t,isHttpUri:n,isHttpsUri:i,isWebUri:r}}()),n={addTextOnClipboard:(e,t,n,i)=>{e.preventDefault();const r=((e,t)=>{const n=e[0].contentWindow.getSelection().getRangeAt(0),i=document.createElement("div");i.append(n.cloneContents());try{i.querySelectorAll(".link").forEach(e=>{const n=e.getAttribute("class"),r=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(n)[1];let l;t[r]?(l=document.createElement("a"),l.innerHTML=e.innerHTML,l.setAttribute("href",t[r].data.hyperlink)):(l=document.createElement("span"),l.innerHTML=e.innerHTML),i.querySelector("."+r).replaceWith(l)})}catch(e){console.error("[ep_full_hyperlinks]: copy data has an error",e)}return i})(t,i);e.originalEvent.clipboardData.setData("text/html",r.outerHTML),n&&t.contents()[0].execCommand("delete")},saveLinks:(e,t)=>{((e,t)=>{const n=e.originalEvent.clipboardData.getData("text/html");if(!t.contents()[0].getSelection().getRangeAt(0))return!1;e.preventDefault();const i=document.createElement("div");i.innerHTML=n;const r=i.getElementsByTagName("a"),l={};for(const e of r){const t=e.href,n=e.innerHTML,i=a.generateLinkId();e.className=i,e.id=i,l[i]={data:{author:"empty",linkId:i,timestamp:(new Date).getTime(),text:n,originalLinkId:i,hyperlink:t,headerId:null,date:new Date,formattedDate:new Date}}}pad.plugins.ep_full_hyperlinks.saveLinkWithoutSelection(clientVars.padId,l),t.contents()[0].execCommand("insertHTML",!1,$("<div>").append($(i).clone()).html())})(e,t)}},i=(()=>{let e;const n=()=>e=e||$('iframe[name="ace_outer"]').contents(),r=()=>n().find("#linkBoxWrapper"),l=()=>r().find(".link-container").hide(),a=(e,t,n)=>{const i=(e=>{let t=0,n=0;return e||(e=window.event),e.pageX||e.pageY?(t=e.pageX,n=e.pageY):(e.clientX||e.clientY)&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,n=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:t,y:n}})(e),r=i.x,l=i.y,a=t.innerWidth(),o=t.outerHeight(!0),s=n.innerWidth(),c=n.outerHeight(!0),p=parseInt(n.css("padding-top")),d=parseInt($(e.target).offset().top),h=parseInt($(e.target).outerHeight(!0));let u=e.clientX+n.offset().left,f=d+h+p/2;s-r<a&&(u=s-a-16),c-l<o&&(f=c-o),$("body").hasClass("mobileView")||(f+=35),t.css({left:u+"px",top:f+"px"})};return{showLink:e=>r().find("#"+e).show(),hideLink:t=>{r().find("#"+t).hide(),e.find("#show-form-"+t).show(),e.find("#edit-form-"+t).hide()},hideAllLinks:l,showLinkModal:(e,o,s)=>{const c=$('iframe[name="ace_outer"]').contents(),p=n().find('iframe[name="ace_inner"]'),d=o.linkId,h=0!==r().find("#"+d).length;if(l(),!o.hyperlink)return console.error("[hyperlink]: link does not exist",o),!1;let u=r().find("#"+d);h||(u=$("#linkBoxTemplate").tmpl({...o}));const f=u.attr("data-loaded");h?(u.show(),o.hyperlink!==u.find("a.ep_hyperlink_title").attr("href")&&u.attr("data-loaded","false"),u.attr("data-hyperlink",o.hyperlink),u.find("input#hyperlink-url").val(o.hyperlink),u.find("a.ep_hyperlink_title").attr({title:o.hyperlink,href:o.hyperlink})):c.find("#linkBoxWrapper").append(u);const k=p.contents().find("."+d).text();if(u.find("input#hyperlink-text-hidden").val(k),u.find("input#hyperlink-text").val(k),"true"!=f){let e,n=o.hyperlink||u.attr("data-hyperlink");try{e=new URL(n)}catch(e){return console.error("[hyperlink]: "+e),void i.hideLink(d)}const r=u.find("#ep_hyperlink_img"),l=u.find("a.ep_hyperlink_title"),a=u.find("#card_loading_hyperlink"),c=u.find("#ep_hyperlink_description");c.text(""),l.text(n),r.hide(),l.show(),a.show(),/^http:\/\//.test(n)||/^https:\/\//.test(n)||(n="https://"+n);const p=function(e,t,n){r.attr("src",n),r.on("load",()=>{a.fadeOut(500,()=>{r.fadeIn(),l.text(t.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")),c.text(e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")),u.attr({"data-loaded":!0})})})};if(!t.isUri(n)){return p(n,n,"../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png"),!1}const h=function(t){if(t.metadata.image&&t.metadata.title)p(n,t.metadata.title,t.metadata.image);else{const i="https://"+e.hostname;!0!==t.last?s.emit("metaResolver",{padId:clientVars.padId,editedHyperlink:i,last:!0},h):p(n,t.metadata.title||n,"../static/plugins/ep_full_hyperlinks/static/dist/img/nometa.png")}};switch(e.hostname){case"twitter.com":p(n,n,"../static/plugins/ep_full_hyperlinks/static/dist/img/twitter.png");break;default:s.emit("metaResolver",{padId:clientVars.padId,hyperlink:n,last:!1},h)}}a(e,u,p),u.addClass("hyperlink-display")},getLinksContainer:r,shouldNotCloseLink:function(e){return!!($(e.target).closest(".link").length||$(e.target).closest(".link-modal").length||$(e.target).closest(".ep_hyperlink_docs_bubble_button_edit").length||$(e.target).closest(".ep_hyperlink_docs_bubble_button_delete").length||$(e.target).closest(".ep_hyperlink_docs_bubble_button_copy").length||$(e.target).closest(".full-display-link").length||$(e.target).closest(".link-title-wrapper").length||$(e.target).closest(".link-edit-form").length||$(e.target).closest(".link-text-text").length||$(e.target).closest(".link-text-hyperlink").length)},internalLinkClick:function(e){e.preventDefault(),e.stopPropagation();const t=$(this).attr("href");if((e=>{const t=new URL(e);let n=!1;if(t.origin!==location.origin)return!1;if(t.origin===location.origin){const e=location.pathname.split("/").indexOf("p")>0,t=clientVars.padId,i=e?"/p/"+t:"/"+t;location.pathname.substring(0,i.length)===i&&(n=!0),clientVars.ep_singlePad.active&&(n=!0)}return n})(t)){const e=new URL(t);let n=""+e.search;const i=(e=>{const t=[],n=clientVars.padId,i=e.pathname.split("/");let r=i.indexOf(n)+1;clientVars.ep_singlePad.active&&(r=0);const l=[...i].splice(r,i.length-1);return t.push(...l),t})(e);if(i.length>0){n=location.pathname.split("/").indexOf("p")>0?"/p":"",clientVars.ep_singlePad.active||(n+="/"+clientVars.padId),n+=`/${i.join("/")}${e.search}`}0===e.search.length&&(n=t);const r=i.length>0?"filter":"other";window.history.pushState({type:"hyperLink",href:t,target:r},document.title,n),l()}else window.open(t,"_blank");return!1}}})(),r=(()=>{const e=e=>{const i=$(document).find("#newLink"),r=(e=>({text:e.find("#hyperlink-text").val(),oldText:e.find("#hyperlink-text-hidden").val(),hyperlink:e.find("#hyperlink-url").val()}))(i);return r.text.length>0&&t.isUri(r.hyperlink)?(i.find("#hyperlink-text, #hyperlink-url").removeClass("error"),n(),e(r,0)):(0===r.text.length&&i.find("#hyperlink-text").addClass("error"),t.isUri(r.hyperlink)||i.find("#hyperlink-url").addClass("error")),!1},n=()=>{$("#newLink").removeClass("popup-show"),$("#newLink").find(":focus").blur(),pad.plugins.ep_full_hyperlinks.preLinkMarker.unmarkSelectedText()};return{insertNewLinkPopupIfDontExist:(t,i)=>{$("#newLink").remove(),t.linkId="";const r=$("#newLinkTemplate").tmpl(t);return r.appendTo($("#editorcontainerbox")),$("#newLink #link-cancel-btn").on("click",e=>n()),$("#newLink #link-create-btn").on("click",t=>e(i)),$(document).on("submit","form.link-edit-form",t=>{t.preventDefault(),e(i)}),r},showNewLinkPopup:()=>{$("body").hasClass("mobileView")||$("#newLink").css("left",$(".toolbar .addLink").offset().left),$("#newLink").find("textarea").val(""),$("#newLink").find(".link-content, .to-value").removeClass("error"),$("#newLink").addClass("popup-show"),pad.plugins.ep_full_hyperlinks.preLinkMarker.markSelectedText(),setTimeout(()=>$("#newLink #hyperlink-url").focus().select(),500)},hideNewLinkPopup:n}})(),l=(()=>{const e="pre-selected-link",t=function(e){this.ace=e;const t=this;this.highlightSelectedText()&&setTimeout(()=>{t.unmarkSelectedText()},0)};t.prototype.highlightSelectedText=function(){return clientVars.highlightSelectedText},t.prototype.markSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(n,"markPreSelectedTextToLink",!0)},t.prototype.unmarkSelectedText=function(){this.highlightSelectedText()&&this.ace.callWithAce(n,"unmarkPreSelectedTextToLink",!0)},t.prototype.performNonUnduableEvent=function(e,t,n){t.startNewEvent("nonundoable"),n(),t.startNewEvent(e)},t.prototype.handleMarkText=function(e){const t=e.editorInfo,n=e.rep,i=e.callstack;this.removeMarks(t,n,i),this.addMark(t,i)},t.prototype.handleUnmarkText=function(e){const t=e.editorInfo,n=e.rep,i=e.callstack;this.removeMarks(t,n,i)},t.prototype.addMark=function(t,n){const i=n.editEvent.eventType;this.performNonUnduableEvent(i,n,()=>{t.ace_setAttributeOnSelection(e,clientVars.userId)})},t.prototype.removeMarks=function(t,n,i){const r=i.editEvent.eventType,l=n.selStart,a=n.selEnd;this.performNonUnduableEvent(r,i,()=>{const n=$('iframe[name="ace_outer"]').contents().find('iframe[name="ace_inner"]'),i=t.ace_getRepFromSelector(".pre-selected-link",n);$.each(i,(n,i)=>{t.ace_performSelectionChange(i[0],i[1],!0),t.ace_setAttributeOnSelection(e,!1)}),t.ace_performSelectionChange(l,a,!0)})};const n=()=>{};return{MARK_CLASS:e,init:e=>new t(e)}})(),a={collectContentPre:(e,t)=>{const n=/(?:^| )(lc-[A-Za-z0-9]*)/.exec(t.cls),i=/(?:^| )(fakelink-[A-Za-z0-9]*)/.exec(t.cls);if(n&&n[1]&&t.cc.doAttrib(t.state,"link::"+n[1]),i){const e=pad.plugins.ep_full_hyperlinks.getMapfakeLinks()[i[1]];t.cc.doAttrib(t.state,"link::"+e)}return[]},generateLinkId:()=>"lc-"+e(16)};return{validUrl:t,events:n,linkBoxes:i,newLink:r,preLinkMark:l,shared:a}})();
//# sourceMappingURL=ep.full.hyperlinks.mini.js.map
